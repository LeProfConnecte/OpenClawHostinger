; =============================================================================
; Supervisor Configuration for OpenClaw on Hostinger VPS
; =============================================================================
;
; NOTE: This is a reference template. The deploy.sh script generates the actual
; config dynamically with correct paths. If you use this file manually, replace:
;   {{SITE_ROOT}} -> your site root (e.g. /home/myopenclaw/htdocs/myopenclaw.leprofconnecte.com)
;   {{DOMAIN}}    -> your domain (e.g. myopenclaw.leprofconnecte.com)
;   {{SITE_USER}} -> your CloudPanel site user (e.g. myopenclaw)
;
; INSTALLATION:
;   sudo cp deploy/supervisor-openclaw.conf /etc/supervisor/conf.d/openclaw.conf
;   sudo supervisorctl reread
;   sudo supervisorctl update
;
; This file manages two processes:
;   1. openclaw-backend  - FastAPI backend via uvicorn
;   2. clawdbot-gateway  - The clawdbot gateway process
; =============================================================================

; --- FastAPI Backend (uvicorn) ---
; Runs as the site user (not root) for security
; Environment variables are loaded from backend/.env by python-dotenv
[program:openclaw-backend]
command={{SITE_ROOT}}/venv/bin/uvicorn server:app --host 127.0.0.1 --port 8000 --workers 1 --log-level info
directory={{SITE_ROOT}}/backend
user={{SITE_USER}}
autostart=true
autorestart=true
startretries=5
startsecs=5
stopwaitsecs=30
redirect_stderr=true
stdout_logfile=/var/log/supervisor/openclaw-backend.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3

; --- Clawdbot Gateway ---
; This process is started/stopped dynamically by the backend via supervisorctl
; autostart=false because the backend controls its lifecycle
; NOTE: Runs as root because it needs access to /root/.clawdbot and /root/nodejs
; The run_clawdbot.sh wrapper sources gateway.env for API keys before starting
[program:clawdbot-gateway]
command=/root/run_clawdbot.sh gateway --config /root/.clawdbot/clawdbot.json
directory=/root
environment=
    NODE_DIR="/root/nodejs",
    CLAWDBOT_DIR="/root/.clawdbot-bin",
    CLAWDBOT_HOME="/root/.clawdbot",
    PATH="/root/nodejs/bin:/root/.clawdbot-bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
user=root
autostart=false
autorestart=unexpected
startretries=3
startsecs=5
stopwaitsecs=15
redirect_stderr=true
stdout_logfile=/var/log/supervisor/clawdbot-gateway.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
